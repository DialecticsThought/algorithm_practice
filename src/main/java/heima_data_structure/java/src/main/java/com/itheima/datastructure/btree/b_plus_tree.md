https://zhuanlan.zhihu.com/p/149287061

https://mp.weixin.qq.com/s/BXfogZuQ0NRYm24zh2NI9w

https://zhuanlan.zhihu.com/p/130698465

删除

1. 定位元素
    - 从 B+
      树的根节点开始查找，将待删除元素与当前节点中的关键字进行比较。如果待删除元素小于当前节点的关键字，就遍历左边的子树节点；如果待删除元素大于当前节点的关键字，就遍历右边的子树节点。然后查找到前面指向的路径的继续查找。这个过程会一直持续，直到找到包含待删除元素的叶子节点。

2. 在子节点中删除元素
    - 找到叶子节点后，从叶子节点的关键字序列中删除目标元素。删除后，需要检查叶子节点中的关键字数量是否满足 B +
      树的下限要求。一般来说，如果 B + 树的阶数为 m（表示一个节点最多有 m - 1 个关键字），那么叶子节点至少应该有 ⌈m/2⌉ - 1
      个关键字。
        - 例如，对于阶数 m = 5 的 B + 树，叶子节点最少应该有 ⌈5/2⌉ - 1 = 2 个关键字。如果删除元素后，叶子节点的关键字数量仍然不低于这个下限，那么删除操作就基本完成了。

3. 叶子节点关键字数量不足 - 借关键字(借用关键字的本质适当做索引，原有节点的被借用的值 不会在原有节点中删除
   相当于拷贝这个值到父节点)
    - 如果叶子节点中关键字数量低于下限，首先尝试从相邻的兄弟节点（左兄弟或右兄弟）借关键字。假设叶子节点为 N，其左兄弟节点为
      L，右兄弟节点为 R。
        - 如果 L 的关键字数量大于 > ⌈m/2⌉ - 1，可以从 L 借一个关键字。具体操作是：将 L 中的最大关键字（假设 L
          中的关键字是升序排列）上移到父节点中，替换父节点中分隔 L 和 N 的关键字，然后将父节点中的这个关键字下移到 N 中。
        - 类似地，如果 R 的关键字数量 > ⌈m/2⌉ - 1，可以从 R 借一个关键字。将 R 中的最小关键字上移到父节点中，替换父节点中分隔
          N 和 R 的关键字，然后将父节点中的这个关键字下移到 N 中。

4. 叶子节点关键字数量不足 - 合并节点
    - 如果相邻兄弟节点（左兄弟和右兄弟）的关键字数量都等于 ⌈m/2⌉ - 1，则无法借关键字，必须需要合并节点。
        - 如果选择与左兄弟节点 L 合并，将 N 中的关键字和 L 中的关键字合并成一个新的节点，这个新节点将取代原来的 L 和 N。
          同时，在父节点中删除分隔 L 和 N 的关键字，并且调整父节点中指向 L 和 N 的指针。
        - 同样，如果选择与右兄弟节点 R 合并，操作类似，将 N 和 R 中的关键字合并，在父节点中进行相应的关键字和指针调整。

5. 通过调节父节点
    - 当合并节点后，父节点的关键字数量可能会减少。如果父节点的关键字数量低于 ⌈m/2⌉ -
      1，就需要对父节点进行类似的调整（借关键字或合并节点）。这个过程可能会一直向上递归，直到根节点。

6. 处理根节点特殊情况
    - 如果在调整过程中，根节点的关键字数量变为 0，且根节点只有一个子节点，那么将这个子节点作为新的根节点，B + 树的高度减
      1。这是一种特殊情况，因为根节点是树的顶层节点，它的变化会影响树的整体结构

7. 当删除某结点中最大或者最小的关键字，就会涉及到更改其双亲结点一直到根结点中所有索引值的更改。

针对情况4和5同同时发生

删除关键字 63，当删除关键字后，该结点中只剩关键字 72，且其兄弟结点 [85、91] 中只有 2 个关键字，
所以将 [72] 和 [85、91] 进行合并，向上回溯，删除结点 [72、91] 当中的关键字 72 ，
此时结点中只有关键 91 ，不满足 B+树中结点关键字个数要求，
但其兄弟结点 [15、44、59] 中包含的 3 个关键字，所以从其兄弟结点当中借一个关键字 59 ,
再对其兄弟结点的父结点中的关键字进行调整，将关键字 59 替换为 44
![GIF](./assets/4_5/4_5.gif")
![png](./assets/4_5/下载.png")



针对4
我们以删除上面这个 B+树中的关键字 59 说明第 4 种情况，
首先查找到关键 59 所在结点 [44、59] ，发现该结点的兄弟结点 [21、37] 包含的关键字的个数 2 等于 ⌈M/2⌉，
所以删除关键字 59 ，并将结点 [21、37] 和 [44] 进行合并 [21、37、44] ，然后向上回溯，将所有关键字 59 替换为次最大的关键字 44
![GIF](./assets/4/ezgif.com-animated-gif-maker.gif")


针对3
当删除某个关键字之后，结点中关键字个数小于 ⌈M/2⌉ ，则不符合 B+树的特性，则需要按照 3 he 4 两种情况分别处理。
以删除关键字 51 为例，由于其兄弟结点 [21、37、44] 中含有 3 个关键字，
所以可以选择借一个关键字 44，同时将双亲结点中的索引值 44 修改 37


针对7
以删除整颗 B+树中最大的关键字 97 为例，查找并删除关键字 97 ， 然后向上回溯，将所有关键字 97 替换为次最大的关键字 91
