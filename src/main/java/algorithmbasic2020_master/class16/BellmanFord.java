package algorithmbasic2020_master.class16;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

/**
 * <pre>
 * Bellman-Ford
 * å‡è®¾å·²ç»çŸ¥é“ä¸€æ¡ä» v_0åˆ° v_jçš„è·¯å¾„ v_0âˆ¼v_jï¼Œè€Œé€šè¿‡æŸä¸€èŠ‚ç‚¹ v_iï¼ˆå’Œv_jç›¸è¿çš„æŸä¸€èŠ‚ç‚¹ï¼‰çš„è·¯å¾„ v_0âˆ¼v_i â†’ v_jæ¯”åŸæ¥çš„è·¯å¾„ v_0âˆ¼v_jçš„è·ç¦»è¦å°ï¼Œ
 * å³ ğ‘‘(v_i)+ğ‘¤(e_i,j)<ğ‘‘(v_j) ï¼Œå…¶ä¸­ d(v_i) è¡¨ç¤ºä»æºèŠ‚ç‚¹ v0åˆ°èŠ‚ç‚¹vçš„è·ç¦»ï¼Œ
 * åˆ™v_0åˆ°èŠ‚ç‚¹v_jçš„è·ç¦»æ›´æ–°ä¸ºğ‘‘(v_j) <- ğ‘‘(v_i)+ğ‘¤(e_i,j):
 *  ä»¥ä¸Šæ“ä½œç§°ä¹‹ä¸ºé€šè¿‡e_i,jå¯¹èŠ‚ç‚¹v_jçš„æ¾å¼›æ“ä½œï¼Œä¹Ÿç§°é€šè¿‡èŠ‚ç‚¹ v_iå¯¹èŠ‚ç‚¹ v_j çš„æ¾å¼›æ“ä½œï¼Œå®šä¹‰ä¸º relax(v_i,v_j)ã€‚
 *
 * 1. åˆå§‹åŒ–ï¼Œå°†æºèŠ‚ç‚¹çš„ d å€¼è®¾ä¸º 0ï¼Œå…¶ä»–èŠ‚ç‚¹è®¾ä¸ºæ— ç©· ä¹Ÿå°±æ˜¯ä»0åˆ°å…¶ä»–ä»»ä½•èŠ‚ç‚¹çš„è·ç¦»=infinte
 *
 * 2. éå†å›¾ä¸­æ‰€æœ‰çš„è¾¹ï¼Œåœ¨éå†æ¯æ¡è¾¹æ—¶ï¼Œåšæ¾å¼›æ“ä½œã€‚
 *
 * 3. å¯¹æ­¥éª¤ 2 é‡å¤ n - 1 æ¬¡
 *
 * 4. åšç¬¬ n æ¬¡éå†ï¼Œå¦‚æœåœ¨æ­¤æ¬¡éå†ä¸­ï¼ŒæŸèŠ‚ç‚¹çš„ d å€¼å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œè¿”å› falseï¼Œå¦åˆ™è¿”å›æ¯ä¸ªèŠ‚ç‚¹çš„ d å€¼ï¼Œå³ä¸ºæºèŠ‚ç‚¹åˆ°æ­¤èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚
 *
 * å®šç†  å¦‚æœå›¾ G = (V, E)ï¼Œ |V| = nï¼Œ |E| = mï¼Œä¸å­˜åœ¨æƒé‡ä¸ºè´Ÿçš„ç¯ï¼Œåˆ™ Bellman-Ford ç®—æ³•è¿”å›çš„å„èŠ‚ç‚¹çš„ d å€¼å³ä¸ºä»æºèŠ‚ç‚¹åˆ°æ­¤èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„çš„é•¿åº¦ã€‚
 *
 * è¯æ˜ï¼š
 * å¯¹äºå›¾ G çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ vï¼Œè®¾å…¶æœ€çŸ­è·¯å¾„ p çš„é•¿åº¦ Î´(v_0, v) ä¸º v_0  -> v_1 -> v_2 -> v_3 -> ....... -> v_i -> vã€‚
 * å› ä¸º p ä¸ºæœ€çŸ­è·¯å¾„ï¼Œä¸”ç”±æœ€çŸ­è·¯å¾„çš„æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼Œå¯å¾— Î´(v_0, v) = Î´(v_0, v_i) + w(v_i, v)ã€‚
 *
 * å›¾ Gï¼ˆä¸åŒ…å«æƒé‡ä¸ºè´Ÿçš„ç¯ï¼‰æºèŠ‚ç‚¹ v_0 åˆ°ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„åŒ…å«è¾¹çš„æ¡æ•°å°äºç­‰äº n - 1ï¼Œ
 * æ‰€ä»¥ç»è¿‡ n - 1 æ­¤æ¾å¼›ä»¥åï¼Œå¯å¾—æºèŠ‚ç‚¹ v_0 åˆ°ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚
 *
 * æ¨è®º å¦‚æœå›¾G=ï¼ˆVï¼ŒE) |v| =n, |E|=m, åœ¨ç»è¿‡n-1æ­¤æ¾å¼›æ”¶æ•›ï¼Œåˆ™å›¾Gå­˜åœ¨æƒé‡ä¸ºè´Ÿçš„ç¯
 * </pre>
 *
 * @Description
 * @Author veritas
 * @Data 2024/8/5 18:26
 */
public class BellmanFord {
    /**
     * <pre>
     *                2
     *          â‘  -------------> â‘¢
     *   -1   â†— â†“             â†™â†—  â†“
     *     â†—    â†“        6 â†™â†—     â†“
     *   0    4 â†“       â†™â†— 7      â†“ 5
     *     â†˜    â†“    â†™â†—           â†“
     *    3   â†˜ â†“ â†™â†—              â†“
     *          â‘¡ -------------> â‘£
     *                 4
     * </pre>
     * <pre>
     * è§„å®šè¾¹çš„æ¾å¼›é¡ºåºæ˜¯edgeï¼š(3,2),(1,3),(2,3),(3,4),(0,1),(0,2),(2,4),(3,2)
     *
     * åˆå§‹åŒ–
     * è·ç¦»æ•°ç»„åˆå§‹åŒ–ï¼šæºèŠ‚ç‚¹0åˆ°å…¶ä»–èŠ‚ç‚¹çš„è·ç¦»åˆå§‹åŒ–ä¸ºæ— ç©·å¤§ï¼ˆâˆï¼‰ï¼Œä½†åˆ°è‡ªèº«çš„è·ç¦»ä¸º0ã€‚
     * d = [0, âˆ, âˆ, âˆ, âˆ]
     *
     * è¿­ä»£è¿‡ç¨‹
     * å¯¹æ¯ä¸€è½®æ¾å¼›ï¼Œæˆ‘ä»¬æŒ‰ç…§æŒ‡å®šçš„é¡ºåºè¿›è¡Œè¾¹çš„æ¾å¼›æ“ä½œï¼Œå¹¶è¿›è¡Œ nâˆ’1 è½®è¿­ä»£ï¼ˆè¿™é‡Œn=5ï¼‰ã€‚
     *
     * ç¬¬1è½®æ¾å¼›æ“ä½œï¼š
     * æŒ‰ç…§é¡ºåºæ¾å¼›è¾¹ï¼š(3,2), (1,3), (2,3), (3,4), (0,1), (0,2), (2,4), (3,2)
     *
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  âˆ > âˆ - 6  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (1,3)ï¼š
     * d[3] > d[1] + weight(1â†’3)  ==>  âˆ > âˆ + 2  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (2,3)ï¼š
     * d[3] > d[2] + weight(2â†’3)  ==>  âˆ > âˆ + 7  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (3,4)ï¼š
     * d[4] > d[3] + weight(3â†’4)  ==>  âˆ > âˆ + 5  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (0,1)ï¼š
     * d[1] > d[0] + weight(0â†’1)  ==>  âˆ > 0 - 1  ==>  d[1] = -1
     *
     * è¾¹ (0,2)ï¼š
     * d[2] > d[0] + weight(0â†’2)  ==>  âˆ > 0 + 3  ==>  d[2] = 3
     *
     * è¾¹ (2,4)ï¼š
     * d[4] > d[2] + weight(2â†’4)  ==>  âˆ > 3 + 4  ==>  d[4] = 7
     *
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  3 > âˆ - 6  ==>  ä¸æ›´æ–°
     *
     * æ›´æ–°åçš„è·ç¦»æ•°ç»„ï¼š
     * d = [0, -1, 3, âˆ, 7]
     *
     * ç¬¬2è½®æ¾å¼›æ“ä½œï¼š
     * æŒ‰ç…§é¡ºåºæ¾å¼›è¾¹ï¼š(3,2), (1,3), (2,3), (3,4), (0,1), (0,2), (2,4), (3,2)
     *
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  3 > âˆ - 6  ==>  ä¸æ›´æ–°
     * è¾¹ (1,3)ï¼š
     * d[3] > d[1] + weight(1â†’3)  ==>  âˆ > -1 + 2  ==>  d[3] = 1
     * è¾¹ (2,3)ï¼š
     * d[3] > d[2] + weight(2â†’3)  ==>  1 > 3 + 7  ==>  ä¸æ›´æ–°
     * è¾¹ (3,4)ï¼š
     * d[4] > d[3] + weight(3â†’4)  ==>  7 > 1 + 5  ==>  d[4] = 6
     * è¾¹ (0,1)ï¼š
     * d[1] > d[0] + weight(0â†’1)  ==>  -1 > 0 - 1  ==>  ä¸æ›´æ–°
     * è¾¹ (0,2)ï¼š
     * d[2] > d[0] + weight(0â†’2)  ==>  3 > 0 + 3  ==>  ä¸æ›´æ–°
     * è¾¹ (2,4)ï¼š
     * d[4] > d[2] + weight(2â†’4)  ==>  6 > 3 + 4  ==>  ä¸æ›´æ–°
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  3 > 1 - 6  ==>  d[2] = -5
     * æ›´æ–°åçš„è·ç¦»æ•°ç»„ï¼š
     * d = [0, -1, -5, 1, 6]
     *
     *
     * ç¬¬3è½®æ¾å¼›æ“ä½œï¼š
     * æŒ‰ç…§é¡ºåºæ¾å¼›è¾¹ï¼š(3,2), (1,3), (2,3), (3,4), (0,1), (0,2), (2,4), (3,2)
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  -5 > 1 - 6  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (1,3)ï¼š
     * d[3] > d[1] + weight(1â†’3)  ==>  1 > -1 + 2  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (2,3)ï¼š
     * d[3] > d[2] + weight(2â†’3)  ==>  1 > -5 + 7  ==>  d[3] = 2
     *
     * è¾¹ (3,4)ï¼š
     * d[4] > d[3] + weight(3â†’4)  ==>  6 > 2 + 5  ==>  d[4] = 7
     *
     * è¾¹ (0,1)ï¼š
     * d[1] > d[0] + weight(0â†’1)  ==>  -1 > 0 - 1  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (0,2)ï¼š
     * d[2] > d[0] + weight(0â†’2)  ==>  -5 > 0 + 3  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (2,4)ï¼š
     * d[4] > d[2] + weight(2â†’4)  ==>  7 > -5 + 4  ==>  d[4] = -1
     *
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  -5 > 2 - 6  ==>  ä¸æ›´æ–°
     *
     * æ›´æ–°åçš„è·ç¦»æ•°ç»„ï¼š
     * d = [0, -1, -5, 2, -1]
     *
     *
     * ç¬¬4è½®æ¾å¼›æ“ä½œï¼š
     * æŒ‰ç…§é¡ºåºæ¾å¼›è¾¹ï¼š(3,2), (1,3), (2,3), (3,4), (0,1), (0,2), (2,4), (3,2)
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  -5 > 2 - 6  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (1,3)ï¼š
     * d[3] > d[1] + weight(1â†’3)  ==>  2 > -1 + 2  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (2,3)ï¼š
     * d[3] > d[2] + weight(2â†’3)  ==>  2 > -5 + 7  ==>  d[3] = 2
     *
     * è¾¹ (3,4)ï¼š
     * d[4] > d[3] + weight(3â†’4)  ==>  -1 > 2 + 5  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (0,1)ï¼š
     * d[1] > d[0] + weight(0â†’1)  ==>  -1 > 0 - 1  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (0,2)ï¼š
     * d[2] > d[0] + weight(0â†’2)  ==>  -5 > 0 + 3  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (2,4)ï¼š
     * d[4] > d[2] + weight(2â†’4)  ==>  -1 > -5 + 4  ==>  ä¸æ›´æ–°
     *
     * è¾¹ (3,2)ï¼š
     * d[2] > d[3] + weight(3â†’2)  ==>  -5 > 2 - 6  ==>  ä¸æ›´æ–°
     *
     * æœ€ç»ˆæ›´æ–°åçš„è·ç¦»æ•°ç»„ï¼š
     * d = [0, -1, -5, 2, -1]
     * </pre>
     * <p>
     * ç»“æœ
     * æœ€ç»ˆå¾—åˆ°ä»æºèŠ‚ç‚¹0åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ï¼š
     * 0åˆ°1çš„æœ€çŸ­è·¯å¾„ï¼š0 â†’ 1ï¼Œé•¿åº¦ä¸º-1
     * 0åˆ°2çš„æœ€çŸ­è·¯å¾„ï¼š0 â†’ 1 â†’ 3 â†’ 2ï¼Œé•¿åº¦ä¸º-5
     * 0åˆ°3çš„æœ€çŸ­è·¯å¾„ï¼š0 â†’ 1 â†’ 3ï¼Œé•¿åº¦ä¸º2
     * 0åˆ°4çš„æœ€çŸ­è·¯å¾„ï¼š0 â†’ 1 â†’ 3 â†’ 2 â†’ 4ï¼Œé•¿åº¦ä¸º-1
     *
     * @param source
     * @param numNodes
     * @param edges
     * @return
     */
    public static Map<Node, Integer> bellmanFord(Node source, int numNodes, ArrayList<Edge> edges) {
        // åˆå§‹åŒ–è·ç¦»æ•°ç»„
        Map<Node, Integer> distances = new HashMap<>();
        for (Edge edge : edges) {
            distances.put(edge.from, Integer.MAX_VALUE);
            distances.put(edge.to, Integer.MAX_VALUE);
        }
        distances.put(source, 0);

        // è¿›è¡Œ numNodes - 1 è½®æ¾å¼›æ“ä½œ
        for (int i = 0; i < numNodes - 1; i++) {
            for (Edge edge : edges) {
                if (distances.get(edge.from) != Integer.MAX_VALUE && distances.get(edge.from) + edge.weight < distances.get(edge.to)) {
                    distances.put(edge.to, distances.get(edge.from) + edge.weight);
                }
            }
        }

        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨è´Ÿç¯
        for (Edge edge : edges) {
            if (distances.get(edge.from) != Integer.MAX_VALUE && distances.get(edge.from) + edge.weight < distances.get(edge.to)) {
                System.out.println("Graph contains a negative weight cycle");
                return null;
            }
        }

        return distances;
    }
}
